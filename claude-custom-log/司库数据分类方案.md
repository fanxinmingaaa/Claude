# 司库管理系统数据分类与技术方案

## 一、分类原则

### 1.1 分类逻辑

| 分类 | 定义 | 处理平台 | 特点 |
|------|------|----------|------|
| **公共数据** | 财务可复用、跨系统共享的基础数据 | 数据湖 | 标准化程度高、业务逻辑简单、复用性强 |
| **司库特有数据** | 司库业务专属、强业务逻辑的数据 | 业务中台 | 业务规则复杂、实时性要求高、需要业务引擎 |

### 1.2 判断标准

**归入数据湖的条件（满足任一）：**
- 财务核算可直接使用（应收、应付、发票、凭证）
- 跨系统共享的主数据（组织、机构、利率）
- 对账类数据（银行对账、余额核对）
- 无复杂业务规则的明细数据

**归入业务中台的条件（满足任一）：**
- 涉及复杂业务流程（票据流转、贷款生命周期）
- 需要业务规则引擎（额度控制、风险计算）
- 实时性要求高（授信占用、额度释放）
- 版本管理需求强（合同版本、担保版本）

---

## 二、数据分类清单

### 2.1 公共数据（数据湖处理）- 共 67 张表

#### 2.1.1 应收应付模块（AR/AP）- 23张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | ar_recbill | 客户应收单 | 财务核算基础数据 |
| 2 | ar_recitem | 客户应收单行 | 财务核算明细 |
| 3 | ar_gatherbill | 客户收款单 | 财务核算基础数据 |
| 4 | ar_gatheritem | 客户收款单行 | 财务核算明细 |
| 5 | ar_estirecbill | 未确认应收单 | 财务核算过渡数据 |
| 6 | ar_estirecitem | 未确认应收单行 | 财务核算明细 |
| 7 | ap_payablebill | 供应商应付单 | 财务核算基础数据 |
| 8 | ap_payableitem | 供应商应付单行 | 财务核算明细 |
| 9 | ap_paybill | 供应商付款单 | 财务核算基础数据 |
| 10 | ap_payitem | 供应商付款单行 | 财务核算明细 |
| 11 | ap_estipayablebill | 暂估应付单 | 财务核算过渡数据 |
| 12 | ap_estipayableitem | 暂估应付单行 | 财务核算明细 |
| 13 | arap_verify | 核销主表 | 财务核销通用 |
| 14 | arap_verifydetail | 核销明细表 | 财务核销明细 |
| 15 | arap_verify_fa | 核销方案表 | 财务配置 |
| 16 | arap_balance | 月余额发生表 | 财务报表基础 |
| 17 | arap_agiotage | 汇兑损益记录表 | 财务核算 |
| 18 | arap_agiotage_d | 汇兑损益子表 | 财务核算明细 |
| 19 | arap_termitem | 收付款协议表 | 财务协议 |
| 20 | arap_tally | 常用字段 | 配置数据 |
| 21 | arap_tally_all | 其他字段 | 配置数据 |
| 22 | arap_tally_agr | 收付款协议 | 财务协议 |
| 23 | arap_billmap | 业务数据映射表 | 数据映射 |

#### 2.1.2 坏账计提模块 - 9张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | arap_bdprovision | 坏账计提 | 财务核算 |
| 2 | arap_bdprovision_d | 坏账计提明细 | 财务核算明细 |
| 3 | arap_bdprovision_dd | 账龄计提明细 | 财务核算明细 |
| 4 | arap_bdprovisionrule | 坏账计提规则 | 财务规则配置 |
| 5 | arap_bdprovisionrule_d | 坏账计提规则明细 | 财务规则配置 |
| 6 | arap_bdprovisionratio | 坏账计提比率 | 财务参数 |
| 7 | arap_provisiondim | 计提维度表 | 财务配置 |
| 8 | arap_ratioversion | 计提比率版本 | 财务配置 |
| 9 | arap_dimratio | 计提比率维度 | 财务配置 |

#### 2.1.3 发票管理模块 - 9张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | sscivm_invoice | 发票信息主实体 | 财务基础数据 |
| 2 | sscivm_invoicedetail | 发票明细 | 财务明细数据 |
| 3 | sscivm_ivapplication | 开票申请单 | 财务流程数据 |
| 4 | sscivm_ivappdetail | 开票申请明细 | 财务明细数据 |
| 5 | sscivm_ivapplog | 开票记录 | 财务日志数据 |
| 6 | sscivm_invoice_relation | 发票关联信息 | 财务关联数据 |
| 7 | sscivm_inv_ina_relation | 申请单发票关联关系 | 财务关联数据 |
| 8 | sscivm_invoice_voucher_bill | 发票凭证单据关系 | 财务凭证关联 |
| 9 | sscivm_billfield | 单据字段映射表 | 配置数据 |

#### 2.1.4 银行对账模块 - 8张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | gl_bankreceipt | 银行对账单 | 财务对账 |
| 2 | gl_corpreceipt | 期初单位日记账 | 财务账务 |
| 3 | gl_contrast | 对账记录 | 财务对账 |
| 4 | gl_contrastaccount | 对账账户实体 | 财务配置 |
| 5 | gl_accountlink | 对账账户关联实体 | 财务配置 |
| 6 | gl_accountstart | 对账账户启用实体 | 财务配置 |
| 7 | gl_balanceadjust | 余额调节表审核 | 财务对账 |
| 8 | ebank_dzd | 银行对账单管理 | 财务对账 |

#### 2.1.5 组织与基础配置 - 7张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | org_reportorg | 报表合并组织编码 | 组织主数据 |
| 2 | org_reportmanastrumember_v | 组织结构_报表组织体系 | 组织主数据 |
| 3 | fi_ratecode | 利率 | 基础参数 |
| 4 | tmpub_fininstitutiontype | 融资机构 | 基础分类 |
| 5 | tmpub_fininstitutions | 融资机构明细 | 基础主数据 |
| 6 | tmpub_finvar | 投融资品种 | 基础分类 |
| 7 | arap_billtype | 收付单据类型 | 基础配置 |

#### 2.1.6 银行账户余额 - 4张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | ebank_balance | 银行账户余额表 | 财务余额数据 |
| 2 | obm_ebank_dpnetconfig_bbank | 资金分析明细银行类别 | 财务分析配置 |
| 3 | obm_ebank_dpnetconfig_borg | 所属集团 | 财务分析配置 |
| 4 | uapbd_virtualaccount | 虚拟账户维护 | 账户基础数据 |

#### 2.1.7 支付确认与结算 - 5张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | ebank_confirmpay_h | 支付确认单 | 财务支付 |
| 2 | ebank_confirmpay_b | 支付确认单子实体 | 财务支付明细 |
| 3 | cmp_settlement | 结算信息 | 财务结算 |
| 4 | cmp_detail | 结算信息明细 | 财务结算明细 |
| 5 | arap_busidata | 收付业务数据 | 财务业务数据 |

#### 2.1.8 合同与商户 - 2张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | batm_ht_b | 合同信息表 | 合同主数据 |
| 2 | obm_merchantno | 商户号 | 商户主数据 |

---

### 2.2 司库特有数据（业务中台处理）- 共 151 张表

#### 2.2.1 票据管理模块 - 36张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | fbm_billacclock | 票据帐锁表 | 票据额度控制 |
| 2 | fbm_billacc_detail | 票据帐明细 | 票据业务明细 |
| 3 | fbm_billacc_dailysum | 票据帐日发生额 | 票据统计 |
| 4 | fbm_register | 票据到期分析 | 票据风险管理 |
| 5 | fbm_register_b | 票据登记子表 | 票据登记 |
| 6 | fbm_counterbook | 票据台帐 | 票据全生命周期 |
| 7 | fbm_counterbook_b | 票据台帐子表 | 票据明细 |
| 8 | fbm_circulate | 票据流转 | 票据流转业务 |
| 9 | fbm_circulate_b | 票据流转子表 | 票据流转明细 |
| 10 | fbm_action | 票据动作 | 票据操作记录 |
| 11 | fbm_accept | 票据付款 | 票据支付业务 |
| 12 | fbm_paybill | 付票登记 | 票据支付登记 |
| 13 | fbm_discount | 票据贴现 | 票据贴现业务 |
| 14 | fbm_discount_b | 票据贴现明细 | 票据贴现明细 |
| 15 | fbm_discountcalculate | 贴现试算 | 票据业务计算 |
| 16 | fbm_discountcalculate_b | 贴现试算子表 | 票据业务计算 |
| 17 | fbm_buyerdiscount | 应付票据贴现 | 票据贴现业务 |
| 18 | fbm_endore | 票据背书 | 票据背书业务 |
| 19 | fbm_impawn | 票据质押 | 票据质押业务 |
| 20 | fbm_storage | 票据托管 | 票据托管业务 |
| 21 | fbm_consignbank | 银行托收 | 票据托收业务 |
| 22 | fbm_consignbank_b | 银行托收子表 | 票据托收明细 |
| 23 | fbm_rreturn | 应收票据退票表 | 票据退票业务 |
| 24 | fbm_rreturn_b | 应收票据退票子表 | 票据退票明细 |
| 25 | fbm_expenselist | 费用清单 | 票据费用 |
| 26 | fbm_expenselist_b | 费用清单明细 | 票据费用明细 |
| 27 | fbm_quotasummary | 额度汇总 | 票据额度管理 |
| 28 | fbm_outer | 票据外部关联 | 票据关联 |
| 29 | fbm_jpb_discount | 票据贴现-集票宝 | 集票宝业务 |
| 30 | fbm_jpb_accept | 承兑 | 票据承兑业务 |
| 31 | fbm_jpb_endorse | 背书 | 票据背书业务 |
| 32 | fbm_jpb_hold | 持票 | 票据持有状态 |
| 33 | fbm_jpb_issue | 出具票据 | 票据出票业务 |
| 34 | cfbm_sign_apply | 开票申请表 | 票据申请 |
| 35 | cfbm_sign_apply_b | 开票申请担保子表 | 票据申请担保 |
| 36 | ebank_billinfoquery | 票据信息查询 | 票据查询 |

#### 2.2.2 贷款管理模块 - 42张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | cdmc_apply | 贷款申请 | 贷款业务流程 |
| 2 | cdmc_contract | 贷款合同 | 贷款核心业务 |
| 3 | cdmc_contract_v | 贷款合同版本 | 贷款版本管理 |
| 4 | cdmc_financepay | 贷款放款主表 | 贷款放款业务 |
| 5 | cdmc_financepay_v | 贷款放款版本 | 贷款版本管理 |
| 6 | cdmc_payplan | 放款计划 | 贷款计划 |
| 7 | cdmc_payplan_v | 放款计划版本 | 贷款版本管理 |
| 8 | cdmc_finplanrepay | 还款计划 | 贷款还款业务 |
| 9 | cdmc_planrepay_v | 还款计划版本 | 贷款版本管理 |
| 10 | cdmc_repayprcpl | 贷款还本 | 贷款还本业务 |
| 11 | cdmc_repprcpl_plan | 还本计划 | 贷款还本计划 |
| 12 | cdmc_repayrule | 还款规则 | 贷款业务规则 |
| 13 | cdmc_repayrule_v | 还款规则版本 | 贷款版本管理 |
| 14 | cdmc_repinterest | 付息 | 贷款付息业务 |
| 15 | cdmc_repintdetail | 付息明细信息 | 贷款付息明细 |
| 16 | cdmc_interestlist | 利息清单 | 贷款利息管理 |
| 17 | cdmc_interestsublist | 利息清单子表 | 贷款利息明细 |
| 18 | cdmc_loaninterestadjust | 贷款利息调整 | 贷款利息调整 |
| 19 | cdmc_finexecute | 执行情况 | 贷款执行跟踪 |
| 20 | cdmc_finexecute_v | 执行情况 | 贷款执行版本 |
| 21 | cdmc_finextinfo | 展期 | 贷款展期业务 |
| 22 | cdmc_extinfo_v | 展期版本 | 贷款展期版本 |
| 23 | cdmc_infinancepay | 借转贷 | 内部贷款业务 |
| 24 | cdmc_infinancepay_v | 借转贷版本 | 内部贷款版本 |
| 25 | cdmc_finbankgroup | 银团信息 | 银团贷款 |
| 26 | cdmc_syndicatedloan | 银团信息 | 银团贷款 |
| 27 | cdmc_syndicatedloan_v | 银团信息版本 | 银团贷款版本 |
| 28 | cdmc_applysyndicatedloan | 银团信息 | 银团贷款申请 |
| 29 | cdmc_consignapply | 委托贷款申请 | 委托贷款业务 |
| 30 | cdmc_consigncontract | 委托贷款合同 | 委托贷款合同 |
| 31 | cdmc_consigncontract_v | 委托贷款合同版本 | 委托贷款版本 |
| 32 | cdmc_consignfinancepay | 委托借款放款主表 | 委托贷款放款 |
| 33 | cdmc_consignfinancepay_v | 委托贷款放款版本 | 委托贷款版本 |
| 34 | cdmc_consignpayplan | 放款计划 | 委托贷款计划 |
| 35 | cdmc_consignpayplan_v | 放款计划版本 | 委托贷款版本 |
| 36 | cdmc_consignfinrepayplan | 委托贷款还款计划 | 委托贷款还款 |
| 37 | cdmc_consignfinrepayplan_v | 委托贷款放款还款计划版本 | 委托贷款版本 |
| 38 | cdmc_consignprcplplan | 还款计划 | 委托贷款还款 |
| 39 | cdmc_consignrepayprcpl | 委托借贷款还本 | 委托贷款还本 |
| 40 | cdmc_consignrepayintst | 委托贷款付息 | 委托贷款付息 |
| 41 | cdmc_consignfinexecute | 委托贷款放款执行情况 | 委托贷款执行 |
| 42 | cdmc_consignfinexecute_v | 委托贷款放款执行情况版本 | 委托贷款版本 |
| 43 | cdmc_consignfinextension | 委托贷款放款展期 | 委托贷款展期 |
| 44 | cdmc_consignfinextension_v | 委托贷款放款展期版本 | 委托贷款版本 |

#### 2.2.3 授信管理模块 - 16张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | ccc_bankprotocol | 银行授信协议 | 授信核心业务 |
| 2 | ccc_bankprotocol_v | 银行授信协议版本 | 授信版本管理 |
| 3 | ccc_protocoldetail | 授信明细 | 授信额度管理 |
| 4 | ccc_protocoldetail_v | 授信明细版本 | 授信版本管理 |
| 5 | ccc_execadj | 授信调整 | 授信额度调整 |
| 6 | ccc_execdetail | 投融资授信执行明细表 | 授信执行跟踪 |
| 7 | ccc_guarantee | 担保合同 | 授信担保 |
| 8 | ccc_guarantee_v | 担保合同版本 | 授信担保版本 |
| 9 | cdmc_conauthinfo | 授信信息 | 授信信息 |
| 10 | cdmc_appauthinfo | 授信信息 | 授信申请信息 |
| 11 | cdmc_finauthinfo | 授信信息 | 授信财务信息 |
| 12 | cdmc_finauthinfo_v | 授信信息版本 | 授信版本管理 |
| 13 | cdmc_authinfo_v | 授信信息版本 | 授信版本管理 |
| 14 | cdmc_repprcpl_credit | 银行授信 | 银行授信 |
| 15 | cdmc_conguarantee | 担保信息 | 授信担保 |
| 16 | cdmc_conguarantee_v | 担保信息版本 | 授信担保版本 |
| 17 | cdmc_repprcpl_grt | 担保信息 | 授信担保 |

#### 2.2.4 担保管理模块 - 22张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | gpmc_guacontract | 担保合同 | 担保核心业务 |
| 2 | gpmc_guacontract_v | 担保合同版本 | 担保版本管理 |
| 3 | gpmc_guaproperty | 担保物权 | 担保物权业务 |
| 4 | gpmc_guaproperty_v | 担保物权版本 | 担保版本管理 |
| 5 | gpmc_guapleinf | 质押信息 | 质押业务 |
| 6 | gpmc_guapleinf_v | 质押信息版本 | 质押版本管理 |
| 7 | gpmc_guaguainf | 抵押信息 | 抵押业务 |
| 8 | gpmc_guaguainf_v | 抵押信息版本 | 抵押版本管理 |
| 9 | gpmc_guawarinf | 保证信息 | 保证业务 |
| 10 | gpmc_guawarinf_v | 保证信息版本 | 保证版本管理 |
| 11 | gpmc_guactrconinf | 反担保合同信息 | 反担保业务 |
| 12 | gpmc_guactrconinf_v | 反担保信息版本 | 反担保版本 |
| 13 | gpmc_guaconquote | 担保债务 | 担保债务管理 |
| 14 | gpmc_guaconquote_v | 担保债务版本 | 担保债务版本 |
| 15 | gpmc_guadetinfo | 集团担保明细 | 集团担保管理 |
| 16 | gpmc_guadetinfo_v | 集团担保明细版本 | 集团担保版本 |
| 17 | gpmc_dbsq_h | 担保申请主表 | 担保申请业务 |
| 18 | gpmc_dbsq_b | 担保申请子表 | 担保申请明细 |
| 19 | gpmc_actrelationdetail | 引用担保合约关系明细 | 担保关联 |
| 20 | gpmc_prorelationdetail | 物权引用明细 | 物权关联 |

#### 2.2.5 保函管理模块 - 6张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | bgm_category | 保函种类 | 保函配置 |
| 2 | bgm_openapply | 开函申请 | 保函申请业务 |
| 3 | bgm_openregister | 开函登记 | 保函登记业务 |
| 4 | bgm_openreport | 开函台账 | 保函台账 |
| 5 | bgm_receiveregister | 收函登记 | 收函业务 |
| 6 | bgm_receivereport | 收函台账 | 收函台账 |

#### 2.2.6 账户管理模块 - 12张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | tam_applybill | 开户申请 | 账户业务 |
| 2 | tam_applybill_b | 开户申请子表 | 账户业务明细 |
| 3 | tam_accountchange | 账户变更申请主表 | 账户变更业务 |
| 4 | tam_accountchang_sub | 账户变更申请子表 | 账户变更明细 |
| 5 | tam_accountchang_new_sub | 账户变更申请新子表 | 账户变更明细 |
| 6 | tam_accountreports | 银行账户管理报告 | 账户报告 |
| 7 | tam_lowaccountrule | 低效账户规则 | 账户管理规则 |
| 8 | tam_lowaccounthandle | 低效账户处理 | 账户处理业务 |
| 9 | tam_lowaccountmaintain | 低效账户维护 | 账户维护 |
| 10 | tam_lowacallocation | 低效账户规则分配 | 账户规则分配 |
| 11 | tam_cancellowaccount | 取消预警账户表 | 账户预警 |
| 12 | tam_unauthaccreason | 账户未授权原因维护 | 账户异常处理 |

#### 2.2.7 债券管理模块 - 2张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | bond_register | 债券发行主表 | 债券业务 |
| 2 | bond_repayprcpl | 本金兑付 | 债券兑付业务 |

#### 2.2.8 融资上报模块 - 5张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | hdgt_sxyh_h | 银行授信上报_主表 | 授信上报业务 |
| 2 | hdgt_sxyh_b | 银行授信上报_子表 | 授信上报明细 |
| 3 | hdgt_rzsb_h | 融资上报_主表 | 融资上报业务 |
| 4 | hdgt_rzsb_b | 融资上报_子表 | 融资上报明细 |
| 5 | rzsb_mx_v | 融资上报明细 | 融资上报明细 |

#### 2.2.9 电票业务模块 - 4张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | ebank_paymentstatus_h | 电票业务指令状态主表 | 电票业务 |
| 2 | ebank_paymentstatus_b | 电票业务指令状态子表 | 电票业务明细 |
| 3 | ebank_dfgz_h | 工资指令主体 | 工资支付业务 |
| 4 | ebank_dfgz_b | 工资指令明细 | 工资支付明细 |

#### 2.2.10 银行回单模块 - 2张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | obm_yhhd | 银行回单 | 司库回单业务 |
| 2 | obm_yhhd_b | 银行回单来源 | 司库回单明细 |

#### 2.2.11 黑名单与关注合同 - 2张表

| 序号 | 表英文名称 | 表中文名称 | 归类原因 |
|------|-----------|-----------|----------|
| 1 | cmp_hmddjvo | 本企业黑名单查询主表 | 风险管理 |
| 2 | cmp_debt_contratc | 关注金额对应合同 | 风险管理 |

---

## 三、数据湖分层计算加工方案

### 3.1 数据分层架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         应用层 (ADS)                             │
│    财务报表、管理驾驶舱、财务分析、跨系统数据服务                    │
├─────────────────────────────────────────────────────────────────┤
│                         汇总层 (DWS)                             │
│    应收汇总、应付汇总、发票统计、对账汇总、坏账统计                   │
├─────────────────────────────────────────────────────────────────┤
│                         明细层 (DWD)                             │
│    应收明细、应付明细、发票明细、对账明细、核销明细                   │
├─────────────────────────────────────────────────────────────────┤
│                         贴源层 (ODS)                             │
│    ar_*, ap_*, arap_*, sscivm_*, gl_*, org_*, fi_*              │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 各层处理逻辑

#### 3.2.1 ODS层（贴源层）

**处理内容：**
- 数据同步：从司库系统全量/增量同步67张公共表
- 数据清洗：去重、空值处理、格式标准化
- 数据校验：主键唯一性、外键关联性检查

**同步策略：**
| 数据类型 | 同步方式 | 频率 | 示例表 |
|----------|----------|------|--------|
| 交易数据 | 增量同步 | 每15分钟 | ar_recbill, ap_paybill |
| 余额数据 | 全量同步 | 每日凌晨 | ebank_balance, arap_balance |
| 配置数据 | 变更同步 | 实时 | fi_ratecode, org_reportorg |

#### 3.2.2 DWD层（明细层）

**处理内容：**
- 维度关联：关联组织、机构、币种等维度
- 数据标准化：统一编码、统一币种换算
- 数据拉链：处理缓慢变化维度

**核心模型：**

```sql
-- 应收明细宽表
CREATE TABLE dwd_ar_receivable_detail (
    receivable_id       STRING COMMENT '应收单ID',
    bill_no             STRING COMMENT '单据号',
    customer_id         STRING COMMENT '客户ID',
    customer_name       STRING COMMENT '客户名称',
    org_id              STRING COMMENT '组织ID',
    org_name            STRING COMMENT '组织名称',
    currency_code       STRING COMMENT '币种',
    original_amount     DECIMAL(18,2) COMMENT '原币金额',
    local_amount        DECIMAL(18,2) COMMENT '本币金额',
    invoice_no          STRING COMMENT '发票号',
    bill_date           DATE COMMENT '单据日期',
    due_date            DATE COMMENT '到期日期',
    verify_amount       DECIMAL(18,2) COMMENT '已核销金额',
    balance_amount      DECIMAL(18,2) COMMENT '余额',
    aging_days          INT COMMENT '账龄天数',
    etl_time            TIMESTAMP COMMENT 'ETL时间'
);

-- 发票明细宽表
CREATE TABLE dwd_invoice_detail (
    invoice_id          STRING COMMENT '发票ID',
    invoice_no          STRING COMMENT '发票号码',
    invoice_type        STRING COMMENT '发票类型',
    invoice_date        DATE COMMENT '开票日期',
    seller_name         STRING COMMENT '销方名称',
    buyer_name          STRING COMMENT '购方名称',
    amount              DECIMAL(18,2) COMMENT '金额',
    tax_amount          DECIMAL(18,2) COMMENT '税额',
    total_amount        DECIMAL(18,2) COMMENT '价税合计',
    org_id              STRING COMMENT '组织ID',
    status              STRING COMMENT '状态',
    etl_time            TIMESTAMP COMMENT 'ETL时间'
);
```

#### 3.2.3 DWS层（汇总层）

**处理内容：**
- 按维度汇总：组织、客户、供应商、时间维度汇总
- 指标计算：余额、发生额、周转率等
- 账龄分析：1-30天、31-60天、61-90天、90天以上

**核心模型：**

```sql
-- 应收账款汇总表
CREATE TABLE dws_ar_receivable_summary (
    stat_date           DATE COMMENT '统计日期',
    org_id              STRING COMMENT '组织ID',
    customer_id         STRING COMMENT '客户ID',
    currency_code       STRING COMMENT '币种',
    begin_balance       DECIMAL(18,2) COMMENT '期初余额',
    debit_amount        DECIMAL(18,2) COMMENT '借方发生额',
    credit_amount       DECIMAL(18,2) COMMENT '贷方发生额',
    end_balance         DECIMAL(18,2) COMMENT '期末余额',
    aging_1_30          DECIMAL(18,2) COMMENT '1-30天账龄',
    aging_31_60         DECIMAL(18,2) COMMENT '31-60天账龄',
    aging_61_90         DECIMAL(18,2) COMMENT '61-90天账龄',
    aging_over_90       DECIMAL(18,2) COMMENT '90天以上账龄',
    bad_debt_provision  DECIMAL(18,2) COMMENT '坏账准备'
);

-- 银行余额汇总表
CREATE TABLE dws_bank_balance_summary (
    stat_date           DATE COMMENT '统计日期',
    org_id              STRING COMMENT '组织ID',
    bank_type           STRING COMMENT '银行类型',
    account_count       INT COMMENT '账户数量',
    total_balance       DECIMAL(18,2) COMMENT '总余额',
    avg_balance         DECIMAL(18,2) COMMENT '日均余额',
    transaction_count   INT COMMENT '交易笔数',
    transaction_amount  DECIMAL(18,2) COMMENT '交易金额'
);
```

#### 3.2.4 ADS层（应用层）

**处理内容：**
- 财务报表数据：资产负债表、利润表相关数据
- 分析指标：应收周转率、应付周转率、坏账率
- 跨系统服务：为司库中台提供财务基础数据

**核心模型：**

```sql
-- 财务分析指标表
CREATE TABLE ads_finance_analysis (
    stat_date               DATE COMMENT '统计日期',
    org_id                  STRING COMMENT '组织ID',
    ar_turnover_days        DECIMAL(10,2) COMMENT '应收周转天数',
    ap_turnover_days        DECIMAL(10,2) COMMENT '应付周转天数',
    bad_debt_ratio          DECIMAL(10,4) COMMENT '坏账率',
    invoice_match_ratio     DECIMAL(10,4) COMMENT '发票匹配率',
    reconciliation_ratio    DECIMAL(10,4) COMMENT '对账匹配率'
);
```

### 3.3 技术实现方案

#### 3.3.1 技术选型

| 组件 | 技术选型 | 用途 |
|------|----------|------|
| 数据存储 | Hive/Iceberg | 数据湖存储 |
| 计算引擎 | Spark | 批量计算 |
| 调度系统 | DolphinScheduler | 任务调度 |
| 数据同步 | DataX/CDC | 数据采集 |
| 数据质量 | Great Expectations | 质量监控 |

#### 3.3.2 数据流转图

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   司库系统    │────▶│   DataX/CDC  │────▶│   ODS层      │
│  (67张表)    │     │   数据同步    │     │  (Hive)      │
└──────────────┘     └──────────────┘     └──────────────┘
                                                 │
                                                 ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   ADS层      │◀────│   DWS层      │◀────│   DWD层      │
│  (指标服务)   │     │  (汇总计算)   │     │  (明细加工)   │
└──────────────┘     └──────────────┘     └──────────────┘
        │
        ▼
┌──────────────────────────────────────────────────────┐
│                    数据服务层                          │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐      │
│  │ 财务报表API │  │ 分析指标API │  │ 中台数据API │      │
│  └────────────┘  └────────────┘  └────────────┘      │
└──────────────────────────────────────────────────────┘
```

---

## 四、司库业务中台分层计算加工方案

### 4.1 数据分层架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         业务服务层                               │
│    票据中心、贷款中心、授信中心、担保中心、账户中心                   │
├─────────────────────────────────────────────────────────────────┤
│                         业务聚合层                               │
│    票据全景、贷款全景、授信全景、担保全景、风险全景                   │
├─────────────────────────────────────────────────────────────────┤
│                         业务明细层                               │
│    票据流水、贷款流水、授信变动、担保变动、账户变动                   │
├─────────────────────────────────────────────────────────────────┤
│                         业务贴源层                               │
│    fbm_*, cdmc_*, ccc_*, gpmc_*, bgm_*, tam_*, bond_*           │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 各层处理逻辑

#### 4.2.1 业务贴源层

**处理内容：**
- 实时同步：核心业务表实时同步（票据、贷款、授信）
- 版本管理：处理_v结尾的版本表，构建时间线
- 状态机：维护业务状态流转

**同步策略：**
| 数据类型 | 同步方式 | 频率 | 示例表 |
|----------|----------|------|--------|
| 票据交易 | 实时CDC | 秒级 | fbm_circulate, fbm_discount |
| 贷款业务 | 实时CDC | 秒级 | cdmc_financepay, cdmc_repayprcpl |
| 授信变动 | 实时CDC | 秒级 | ccc_execadj, ccc_protocoldetail |
| 担保信息 | 增量同步 | 分钟级 | gpmc_guacontract |
| 配置数据 | 变更同步 | 分钟级 | bgm_category |

#### 4.2.2 业务明细层

**处理内容：**
- 业务事件化：将业务操作转化为事件流
- 关联整合：关联合同、额度、担保等维度
- 业务计算：计算利息、费用、期限等

**核心模型：**

```sql
-- 票据业务事件表
CREATE TABLE bdm_bill_event (
    event_id            STRING COMMENT '事件ID',
    bill_no             STRING COMMENT '票据号码',
    event_type          STRING COMMENT '事件类型(出票/背书/贴现/托收/兑付)',
    event_time          TIMESTAMP COMMENT '事件时间',
    event_amount        DECIMAL(18,2) COMMENT '事件金额',
    from_party          STRING COMMENT '转出方',
    to_party            STRING COMMENT '转入方',
    operator            STRING COMMENT '操作人',
    contract_no         STRING COMMENT '关联合同号',
    org_id              STRING COMMENT '组织ID',
    status              STRING COMMENT '状态',
    version             INT COMMENT '版本号'
);

-- 贷款业务流水表
CREATE TABLE bdm_loan_transaction (
    transaction_id      STRING COMMENT '交易ID',
    contract_no         STRING COMMENT '合同编号',
    transaction_type    STRING COMMENT '交易类型(放款/还本/付息/展期)',
    transaction_date    DATE COMMENT '交易日期',
    principal_amount    DECIMAL(18,2) COMMENT '本金金额',
    interest_amount     DECIMAL(18,2) COMMENT '利息金额',
    outstanding_principal DECIMAL(18,2) COMMENT '剩余本金',
    interest_rate       DECIMAL(10,6) COMMENT '利率',
    borrower_id         STRING COMMENT '借款人ID',
    lender_id           STRING COMMENT '贷款人ID',
    credit_id           STRING COMMENT '授信ID',
    guarantee_id        STRING COMMENT '担保ID',
    version             INT COMMENT '版本号'
);

-- 授信额度变动表
CREATE TABLE bdm_credit_change (
    change_id           STRING COMMENT '变动ID',
    credit_id           STRING COMMENT '授信ID',
    bank_id             STRING COMMENT '银行ID',
    change_type         STRING COMMENT '变动类型(新增/调增/调减/占用/释放)',
    change_date         DATE COMMENT '变动日期',
    credit_limit        DECIMAL(18,2) COMMENT '授信额度',
    used_amount         DECIMAL(18,2) COMMENT '已用额度',
    available_amount    DECIMAL(18,2) COMMENT '可用额度',
    business_type       STRING COMMENT '业务类型',
    business_id         STRING COMMENT '业务ID',
    org_id              STRING COMMENT '组织ID',
    version             INT COMMENT '版本号'
);
```

#### 4.2.3 业务聚合层

**处理内容：**
- 业务全景：构建票据、贷款、授信等业务的360度视图
- 风险计算：计算敞口、逾期、到期预警等
- 额度计算：实时计算各类额度使用情况

**核心模型：**

```sql
-- 票据业务全景表
CREATE TABLE bds_bill_panorama (
    bill_no             STRING COMMENT '票据号码',
    bill_type           STRING COMMENT '票据类型',
    bill_amount         DECIMAL(18,2) COMMENT '票据金额',
    issue_date          DATE COMMENT '出票日期',
    due_date            DATE COMMENT '到期日期',
    drawer              STRING COMMENT '出票人',
    acceptor            STRING COMMENT '承兑人',
    current_holder      STRING COMMENT '当前持有人',
    current_status      STRING COMMENT '当前状态',
    endorsement_count   INT COMMENT '背书次数',
    discount_amount     DECIMAL(18,2) COMMENT '贴现金额',
    discount_rate       DECIMAL(10,6) COMMENT '贴现利率',
    pledge_status       STRING COMMENT '质押状态',
    pledge_amount       DECIMAL(18,2) COMMENT '质押金额',
    risk_level          STRING COMMENT '风险等级',
    days_to_maturity    INT COMMENT '距到期天数'
);

-- 贷款业务全景表
CREATE TABLE bds_loan_panorama (
    contract_no         STRING COMMENT '合同编号',
    loan_type           STRING COMMENT '贷款类型',
    borrower_id         STRING COMMENT '借款人ID',
    borrower_name       STRING COMMENT '借款人名称',
    lender_id           STRING COMMENT '贷款人ID',
    contract_amount     DECIMAL(18,2) COMMENT '合同金额',
    disbursed_amount    DECIMAL(18,2) COMMENT '已放款金额',
    outstanding_principal DECIMAL(18,2) COMMENT '未还本金',
    accrued_interest    DECIMAL(18,2) COMMENT '应计利息',
    overdue_principal   DECIMAL(18,2) COMMENT '逾期本金',
    overdue_interest    DECIMAL(18,2) COMMENT '逾期利息',
    interest_rate       DECIMAL(10,6) COMMENT '利率',
    start_date          DATE COMMENT '起始日期',
    end_date            DATE COMMENT '到期日期',
    next_repay_date     DATE COMMENT '下次还款日',
    next_repay_amount   DECIMAL(18,2) COMMENT '下次还款金额',
    guarantee_type      STRING COMMENT '担保方式',
    guarantee_amount    DECIMAL(18,2) COMMENT '担保金额',
    credit_id           STRING COMMENT '授信ID',
    credit_usage        DECIMAL(18,2) COMMENT '占用授信',
    loan_status         STRING COMMENT '贷款状态',
    risk_level          STRING COMMENT '风险等级'
);

-- 授信额度全景表
CREATE TABLE bds_credit_panorama (
    credit_id           STRING COMMENT '授信ID',
    bank_id             STRING COMMENT '银行ID',
    bank_name           STRING COMMENT '银行名称',
    org_id              STRING COMMENT '组织ID',
    org_name            STRING COMMENT '组织名称',
    credit_type         STRING COMMENT '授信类型',
    currency_code       STRING COMMENT '币种',
    total_limit         DECIMAL(18,2) COMMENT '总额度',
    used_limit          DECIMAL(18,2) COMMENT '已用额度',
    available_limit     DECIMAL(18,2) COMMENT '可用额度',
    frozen_limit        DECIMAL(18,2) COMMENT '冻结额度',
    loan_usage          DECIMAL(18,2) COMMENT '贷款占用',
    bill_usage          DECIMAL(18,2) COMMENT '票据占用',
    guarantee_usage     DECIMAL(18,2) COMMENT '保函占用',
    start_date          DATE COMMENT '起始日期',
    end_date            DATE COMMENT '到期日期',
    days_to_expiry      INT COMMENT '距到期天数',
    usage_ratio         DECIMAL(10,4) COMMENT '使用率',
    status              STRING COMMENT '状态'
);

-- 担保业务全景表
CREATE TABLE bds_guarantee_panorama (
    guarantee_id        STRING COMMENT '担保ID',
    guarantee_type      STRING COMMENT '担保类型(抵押/质押/保证)',
    contract_no         STRING COMMENT '担保合同号',
    guarantor_id        STRING COMMENT '担保人ID',
    guarantor_name      STRING COMMENT '担保人名称',
    guaranteed_party    STRING COMMENT '被担保人',
    guarantee_amount    DECIMAL(18,2) COMMENT '担保金额',
    used_amount         DECIMAL(18,2) COMMENT '已使用金额',
    available_amount    DECIMAL(18,2) COMMENT '可用金额',
    collateral_type     STRING COMMENT '担保物类型',
    collateral_value    DECIMAL(18,2) COMMENT '担保物价值',
    pledge_ratio        DECIMAL(10,4) COMMENT '质押率',
    start_date          DATE COMMENT '起始日期',
    end_date            DATE COMMENT '到期日期',
    related_loans       INT COMMENT '关联贷款笔数',
    related_bills       INT COMMENT '关联票据笔数',
    status              STRING COMMENT '状态',
    risk_level          STRING COMMENT '风险等级'
);
```

#### 4.2.4 业务服务层

**处理内容：**
- 业务中心：票据中心、贷款中心、授信中心等
- 实时指标：实时计算业务指标
- 预警服务：到期预警、额度预警、风险预警

**核心模型：**

```sql
-- 司库业务指标表
CREATE TABLE bds_treasury_metrics (
    stat_date           DATE COMMENT '统计日期',
    org_id              STRING COMMENT '组织ID',
    -- 票据指标
    bill_holding_amount     DECIMAL(18,2) COMMENT '持票金额',
    bill_due_7days          DECIMAL(18,2) COMMENT '7日内到期票据',
    bill_discount_rate      DECIMAL(10,4) COMMENT '平均贴现利率',
    -- 贷款指标
    loan_outstanding        DECIMAL(18,2) COMMENT '贷款余额',
    loan_overdue_amount     DECIMAL(18,2) COMMENT '逾期贷款金额',
    loan_overdue_ratio      DECIMAL(10,4) COMMENT '逾期率',
    loan_avg_rate           DECIMAL(10,6) COMMENT '平均贷款利率',
    -- 授信指标
    credit_total_limit      DECIMAL(18,2) COMMENT '授信总额度',
    credit_used_limit       DECIMAL(18,2) COMMENT '已用额度',
    credit_usage_ratio      DECIMAL(10,4) COMMENT '授信使用率',
    credit_expire_30days    DECIMAL(18,2) COMMENT '30日内到期授信',
    -- 担保指标
    guarantee_total         DECIMAL(18,2) COMMENT '担保总额',
    guarantee_exposure      DECIMAL(18,2) COMMENT '担保敞口',
    counter_guarantee_ratio DECIMAL(10,4) COMMENT '反担保覆盖率'
);

-- 业务预警表
CREATE TABLE bds_treasury_alert (
    alert_id            STRING COMMENT '预警ID',
    alert_type          STRING COMMENT '预警类型',
    alert_level         STRING COMMENT '预警级别(高/中/低)',
    business_type       STRING COMMENT '业务类型',
    business_id         STRING COMMENT '业务ID',
    org_id              STRING COMMENT '组织ID',
    alert_content       STRING COMMENT '预警内容',
    alert_time          TIMESTAMP COMMENT '预警时间',
    due_date            DATE COMMENT '到期日期',
    amount              DECIMAL(18,2) COMMENT '涉及金额',
    handler             STRING COMMENT '处理人',
    handle_status       STRING COMMENT '处理状态',
    handle_time         TIMESTAMP COMMENT '处理时间'
);
```

### 4.3 技术实现方案

#### 4.3.1 技术选型

| 组件 | 技术选型 | 用途 |
|------|----------|------|
| 实时计算 | Flink | 实时业务处理 |
| 流存储 | Kafka | 业务事件流 |
| 状态存储 | Redis | 额度缓存、状态缓存 |
| 业务存储 | MySQL/TiDB | 业务数据存储 |
| 规则引擎 | Drools | 业务规则计算 |
| 任务调度 | XXL-Job | 批量任务调度 |

#### 4.3.2 数据流转图

```
┌──────────────────────────────────────────────────────────────────────────┐
│                              司库业务系统                                  │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │ 票据系统  │ │ 贷款系统  │ │ 授信系统  │ │ 担保系统  │ │ 账户系统  │        │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
└──────────────────────────────────────────────────────────────────────────┘
        │              │              │              │              │
        └──────────────┴──────────────┴──────────────┴──────────────┘
                                      │
                                      ▼
                            ┌──────────────────┐
                            │   Kafka 事件流    │
                            │  (业务事件总线)   │
                            └──────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    ▼                 ▼                 ▼
           ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
           │ Flink 实时层  │  │ Flink 实时层  │  │ Flink 实时层  │
           │ (额度计算)    │  │ (风险计算)    │  │ (预警计算)    │
           └──────────────┘  └──────────────┘  └──────────────┘
                    │                 │                 │
                    ▼                 ▼                 ▼
           ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
           │    Redis     │  │   MySQL/TiDB  │  │  预警中心    │
           │  (额度缓存)   │  │  (业务存储)   │  │  (通知服务)  │
           └──────────────┘  └──────────────┘  └──────────────┘
                    │                 │                 │
                    └─────────────────┴─────────────────┘
                                      │
                                      ▼
                            ┌──────────────────┐
                            │   业务服务层      │
                            │ (API/微服务)     │
                            └──────────────────┘
```

#### 4.3.3 实时计算示例

```java
// Flink 授信额度实时计算
public class CreditLimitCalculator extends KeyedProcessFunction<String, CreditEvent, CreditSnapshot> {

    private ValueState<CreditSnapshot> creditState;

    @Override
    public void processElement(CreditEvent event, Context ctx, Collector<CreditSnapshot> out) {
        CreditSnapshot snapshot = creditState.value();
        if (snapshot == null) {
            snapshot = new CreditSnapshot(event.getCreditId());
        }

        switch (event.getEventType()) {
            case "OCCUPY":  // 占用额度
                snapshot.setUsedLimit(snapshot.getUsedLimit().add(event.getAmount()));
                snapshot.setAvailableLimit(snapshot.getTotalLimit().subtract(snapshot.getUsedLimit()));
                break;
            case "RELEASE": // 释放额度
                snapshot.setUsedLimit(snapshot.getUsedLimit().subtract(event.getAmount()));
                snapshot.setAvailableLimit(snapshot.getTotalLimit().subtract(snapshot.getUsedLimit()));
                break;
            case "ADJUST":  // 调整额度
                snapshot.setTotalLimit(event.getAmount());
                snapshot.setAvailableLimit(snapshot.getTotalLimit().subtract(snapshot.getUsedLimit()));
                break;
        }

        snapshot.setUpdateTime(event.getEventTime());
        snapshot.setUsageRatio(snapshot.getUsedLimit().divide(snapshot.getTotalLimit(), 4, RoundingMode.HALF_UP));

        creditState.update(snapshot);
        out.collect(snapshot);

        // 额度预警检查
        if (snapshot.getUsageRatio().compareTo(new BigDecimal("0.8")) > 0) {
            // 发送额度预警
            sendAlert(snapshot);
        }
    }
}
```

---

## 五、两部分协同方案

### 5.1 数据交互架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              数据湖平台                                   │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                         公共数据服务                               │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐  │  │
│  │  │ 应收应付API │  │  发票API   │  │  对账API   │  │  组织API   │  │  │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ 数据服务调用
                                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            司库业务中台                                   │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                        业务数据服务                                │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐  │  │
│  │  │ 票据中心API │  │ 贷款中心API│  │ 授信中心API│  │ 担保中心API│  │  │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                      │                                  │
│                                      │ 业务事件推送                      │
│                                      ▼                                  │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                     数据回流服务                                   │  │
│  │            (业务结果数据回流至数据湖)                               │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.2 数据交互场景

| 场景 | 数据流向 | 说明 |
|------|----------|------|
| 贷款利息计算 | 数据湖→中台 | 中台从数据湖获取利率基准数据 |
| 客户信用评估 | 数据湖→中台 | 中台从数据湖获取应收账龄、坏账数据 |
| 授信额度更新 | 中台→数据湖 | 中台将授信使用情况回流至数据湖 |
| 担保关联查询 | 中台→数据湖 | 中台将担保合同关联的发票数据回流 |
| 财务报表生成 | 双向 | 数据湖汇总中台业务数据生成报表 |

### 5.3 数据一致性保障

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           数据一致性方案                                  │
├─────────────────────────────────────────────────────────────────────────┤
│  1. 事务一致性                                                           │
│     - 分布式事务：Seata AT模式                                           │
│     - 本地事务：业务系统保证                                              │
│     - 最终一致性：事件驱动+补偿机制                                       │
├─────────────────────────────────────────────────────────────────────────┤
│  2. 数据对账机制                                                         │
│     - T+1全量对账：每日凌晨核对双方数据                                    │
│     - 实时对账：关键业务实时校验                                          │
│     - 差异处理：自动修复+人工介入                                         │
├─────────────────────────────────────────────────────────────────────────┤
│  3. 数据血缘追踪                                                         │
│     - 全链路追踪：从源头到应用的完整链路                                   │
│     - 影响分析：变更影响范围评估                                          │
│     - 版本管理：数据版本化管理                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 六、实施路线图

### 6.1 实施阶段

| 阶段 | 内容 | 交付物 |
|------|------|--------|
| **第一阶段** | 数据分类与梳理 | 数据分类清单、数据字典 |
| **第二阶段** | 数据湖建设 | ODS/DWD/DWS/ADS四层模型 |
| **第三阶段** | 业务中台建设 | 实时计算平台、业务服务API |
| **第四阶段** | 协同对接 | 数据服务对接、一致性保障 |
| **第五阶段** | 优化迭代 | 性能优化、功能增强 |

### 6.2 关键里程碑

```
第一阶段                第二阶段                第三阶段                第四阶段
    │                      │                      │                      │
    ▼                      ▼                      ▼                      ▼
┌────────┐            ┌────────┐            ┌────────┐            ┌────────┐
│数据分类 │───────────▶│数据湖上线│───────────▶│中台上线 │───────────▶│全面对接│
│清单完成 │            │67张表   │            │151张表  │            │数据服务│
└────────┘            └────────┘            └────────┘            └────────┘
```

---

## 七、总结

### 7.1 数据分布

| 分类 | 表数量 | 占比 | 处理平台 |
|------|--------|------|----------|
| 公共数据 | 67张 | 30.7% | 数据湖 |
| 司库特有数据 | 151张 | 69.3% | 业务中台 |
| **合计** | **218张** | **100%** | - |

### 7.2 技术方案对比

| 维度 | 数据湖 | 业务中台 |
|------|--------|----------|
| 数据特点 | 标准化、可复用 | 业务化、强逻辑 |
| 处理模式 | 批处理为主 | 实时处理为主 |
| 时效性 | T+1为主 | 秒级/分钟级 |
| 计算引擎 | Spark | Flink |
| 存储 | Hive/Iceberg | MySQL/TiDB/Redis |
| 服务方式 | 数据服务API | 业务服务API |

### 7.3 核心价值

1. **数据复用**：财务公共数据在数据湖统一加工，避免重复建设
2. **业务敏捷**：司库特有业务在中台快速响应，支持实时计算
3. **统一治理**：建立数据标准，保障数据质量
4. **协同增效**：数据湖与中台协同，实现1+1>2的效果
